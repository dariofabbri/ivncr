<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui">
	
	<p:panelGrid styleClass="multi-col-layout" id="testataPanel">
		
		<p:row>
			
			<p:column>
	
				<p:panelGrid styleClass="form-panel">
					
					<p:row>
						<p:column>
							<p:outputLabel for="matricola" value="Matricola:" />
						</p:column>
						<p:column>
							<p:inputText value="#{dettaglioAddettoGenerale.matricola}" id="matricola"
								required="true" requiredMessage="Il campo codice è obbligatorio"
								validator="matricolaAddettoValidator" validatorMessage="La matricola dell'addetto non rispetta la struttura ammessa (nnnnn dove n è una cifra tra 0 e 9)"
								disabled="true"/>
							<p:watermark for="matricola" value="Matricola dell\'addetto" />  
							<p:tooltip for="matricola" showEffect="fade" value="La matricola rappresenta univocamente l'addetto" />
						</p:column>
					</p:row>
					
					<p:row>
						<p:column>							
							<p:outputLabel for="nome" value="Nome:" />
						</p:column>
						<p:column>
							<p:inputText value="#{dettaglioAddettoGenerale.nome}" id="nome"
								required="true" requiredMessage="Il campo nome è obbligatorio"/>
							<p:watermark for="nome" value="Nome dell\'addetto" />  
							<p:tooltip for="nome" showEffect="fade" value="Campo nome dell'addetto" />
						</p:column>
					</p:row>
					
					<p:row>
						<p:column>							
							<p:outputLabel for="cognome" value="Cognome:" />
						</p:column>
						<p:column>
							<p:inputText value="#{dettaglioAddettoGenerale.cognome}" id="cognome"
								required="true" requiredMessage="Il campo cognome è obbligatorio"/>
							<p:watermark for="cognome" value="Cognome dell\'addetto" />  
							<p:tooltip for="cognome" showEffect="fade" value="Campo cognome dell'addetto" />
						</p:column>
					</p:row>
					
					<p:row>
						<p:column>							
							<p:outputLabel for="dataNascita" value="Data di nascita:" />
						</p:column>
						<p:column>
							<p:calendar value="#{dettaglioAddettoGenerale.dataNascita}" id="dataNascita"
								required="true" requiredMessage="Il campo data di nascita è obbligatorio"
								locale="it" pattern="dd/MM/yyyy"/>
							<p:watermark for="dataNascita" value="Data di nascita dell\'addetto" />  
							<p:tooltip for="dataNascita" showEffect="fade" value="Campo data di nascita dell'addetto" />
						</p:column>
					</p:row>
					
					<p:row>
						<p:column>							
							<p:outputLabel for="luogoNascita" value="Luogo di nascita:" />
						</p:column>
						<p:column>
							<p:inputText value="#{dettaglioAddettoGenerale.luogoNascita}" id="luogoNascita"
								required="true" requiredMessage="Il campo luogo di nascita è obbligatorio"/>
							<p:watermark for="luogoNascita" value="Luogo di nascita dell\'addetto" />  
							<p:tooltip for="luogoNascita" showEffect="fade" value="Campo luogo di nascita dell'addetto" />
						</p:column>
					</p:row>

					<p:row>
						<p:column>
							<p:outputLabel for="codiceFiscale" value="Codice fiscale:" />
						</p:column>
						<p:column>
							<p:inputText value="#{dettaglioAddettoGenerale.codiceFiscale}" id="codiceFiscale"
								required="true" requiredMessage="Il campo codice fiscale è obbligatorio"
								validator="codiceFiscaleValidator" validatorMessage="Il codice fiscale inserito non è valido"/>
							<p:watermark for="codiceFiscale" value="Codice fiscale dell\'addetto" />  
							<p:tooltip for="codiceFiscale" showEffect="fade" value="Codice fiscale dell'addetto" />
						</p:column>
					</p:row>

					<p:row>
						<p:column>
							<p:outputLabel for="sesso" value="Sesso:" />
						</p:column>
						<p:column>
							<p:selectOneMenu
								required="true" 
								requiredMessage="Il campo sesso è obbligatorio"
								id="sesso" 
								value="#{dettaglioAddettoGenerale.sesso}"
								effect="fade">
								<f:selectItem itemLabel="Selezionare un sesso" itemValue="" />
								<f:selectItem itemLabel="Maschile" itemValue="M" />
								<f:selectItem itemLabel="Femminile" itemValue="F" />
							</p:selectOneMenu>	
							<p:tooltip for="sesso" showEffect="fade" value="Sesso dell'addetto" />
						</p:column>
					</p:row>
					
					<p:row>
						<p:column>
							<p:outputLabel for="codiceStatoCivile" value="Stato civile:" />
						</p:column>
						<p:column>
							<p:selectOneMenu
								required="true" 
								requiredMessage="Il campo stato civile è obbligatorio"
								id="codiceStatoCivile" 
								value="#{dettaglioAddettoGenerale.codiceStatoCivile}"
								effect="fade">
								<f:selectItem itemLabel="Selezionare uno stato civile" itemValue="" />
								<f:selectItems 
									value="#{dettaglioAddettoGenerale.listStatoCivile}" var="item"
									itemLabel="#{item.descrizione}" itemValue="#{item.id}" />
							</p:selectOneMenu>			 		 
							<p:tooltip for="codiceStatoCivile" showEffect="fade" value="Stato civile dell'addetto" />
						</p:column>
					</p:row>	
					
					<p:row>
						<p:column>							
							<p:outputLabel for="dataGiuramento" value="Data giuramento:" />
						</p:column>
						<p:column>
							<p:calendar value="#{dettaglioAddettoGenerale.dataGiuramento}" id="dataGiuramento"
								locale="it" pattern="dd/MM/yyyy"/>
							<p:watermark for="dataGiuramento" value="Data del giuramento dell\'addetto" />  
							<p:tooltip for="dataGiuramento" showEffect="fade" value="Data del giuramento come G.P.G. dell'addetto" />
						</p:column>
					</p:row>
					
					<p:row>
						<p:column>							
							<p:outputLabel for="fittizio" value="Fittizio:" />
						</p:column>
						<p:column>
							<p:selectBooleanCheckbox value="#{dettaglioAddettoGenerale.fittizio}" id="fittizio"/>
							<p:tooltip for="fittizio" showEffect="fade" value="Indica un addetto fittizio" />
						</p:column>
					</p:row>

				</p:panelGrid>
				
			</p:column>
			
			<p:column rendered="#{not empty dettaglioAddettoGenerale.id}">							
		
				<p:panelGrid styleClass="form-panel">
				
					<p:row>
					
						<p:column>
							
							<p:fieldset 
								id="fotoAddetto" 
								legend="Fotografia" 
								collapsed="true" 
								toggleable="true" 
								toggleSpeed="500"> 
					
								<p:panelGrid styleClass="form-panel">
								
									<p:row>
										<p:column>
											<c:if test="#{empty dettaglioAddettoFoto.current}">
												<p:graphicImage name="img/image-not-present.jpg" library="default"/>
											</c:if>
											<c:if test="#{not empty dettaglioAddettoFoto.current}">
												<p:graphicImage value="#{dettaglioAddettoFoto.current}"/>
											</c:if>
										</p:column>
									</p:row>
									
									<p:row>
										<p:column>
											<p:commandButton value="Elimina"
												type="button"
												disabled="#{empty dettaglioAddettoFoto.current}"
												onclick="deleteFotoDialogWidget.show()"/>

											<p:commandButton value="Scatta"
												oncomplete="scattaFotoDialogWidget.show()"
												update=":detailForm:scattaFotoDialog"/>

											<p:commandButton value="Da file"
												oncomplete="uploadFotoDialogWidget.show()"
												update=":detailForm:uploadFotoDialog"/>
										</p:column>
										
									</p:row>
								
								</p:panelGrid>
								
							</p:fieldset>
							
						</p:column>
					
					</p:row>
				
					<p:row>
					
						<p:column>
							
							<p:fieldset 
								id="familiari" 
								legend="Familiari" 
								collapsed="true" 
								toggleable="true" 
								toggleSpeed="500">
					
								<p:panelGrid styleClass="form-panel">
								
									<p:row>
									
										<p:column>
										
											<p:dataTable
												id="familiariTable"
												var="familiare"
												value="#{dettaglioAddettoFamiliari.listFamiliari}"
												selectionMode="single"
												selection="#{dettaglioAddettoFamiliari.selected}"
												rowKey="#{familiare.id}"
												sortBy="#{familiare.tipoFamiliare.descrizione}"
												emptyMessage="Nessun record trovato" 
												styleClass="small-datatable">

												<p:ajax event="rowSelect" update=":detailForm:familiariButtons"/>
								
												<p:ajax event="rowUnselect" update=":detailForm:familiariButtons"/>

												<p:column 
													sortBy="#{familiare.tipoFamiliare.descrizione}"
													headerText="Grado">
													<h:outputText value="#{familiare.tipoFamiliare.descrizione}"/>
												</p:column>

												<p:column 
													sortBy="#{familiare.nome}"
													headerText="Nome">
													<h:outputText value="#{familiare.nome}"/>
												</p:column>

												<p:column 
													sortBy="#{familiare.cognome}"
													headerText="Cognome">
													<h:outputText value="#{familiare.cognome}"/>
												</p:column>

												<p:column 
													sortBy="#{familiare.luogoNascita}"
													headerText="Luogo nascita">
													<h:outputText value="#{familiare.luogoNascita}"/>
												</p:column>

												<p:column 
													sortBy="#{familiare.dataNascita}"
													headerText="Data nascita">
													<h:outputText value="#{familiare.dataNascita}">
														<f:convertDateTime pattern="dd/MM/yyyy" timeZone="#{appConfig.timeZone}" />
													</h:outputText>
												</p:column>
																									
											</p:dataTable>
										
										</p:column>
										
									</p:row>
									
									<p:row>
										<p:column>
											
											<p:outputPanel id="familiariButtons">
												
												<p:commandButton value="Nuovo"
													oncomplete="detailFamiliareDialogWidget.show()"
													actionListener="#{dettaglioAddettoFamiliari.startCreate}"
													process="@this"
													update=":detailForm:detailFamiliareView:detailFamiliareDialog"/>
	
												<p:commandButton value="Modifica"
													disabled="#{empty dettaglioAddettoFamiliari.selected}"
													oncomplete="detailFamiliareDialogWidget.show()"
													actionListener="#{dettaglioAddettoFamiliari.startUpdate}"
													process="@this"
													update=":detailForm:detailFamiliareView:detailFamiliareDialog"/>
	
												<p:commandButton value="Elimina"
													disabled="#{empty dettaglioAddettoFamiliari.selected}"
													type="button"
													onclick="deleteFamiliareDialogWidget.show()"/>
												
											</p:outputPanel>
											
										</p:column>
									</p:row>
									
								</p:panelGrid>

							</p:fieldset>
							
						</p:column>
						
					</p:row> 
					
				</p:panelGrid>
				
			</p:column>
			
		</p:row>
		
		<p:row>
		
			<p:column colspan="2" styleClass="form-footer">
				<p:commandButton
					id="saveButton"
					value="Salva"
					actionListener="#{dettaglioAddettoGenerale.doSave}"
					update="@form"
					process="testataPanel"
					icon="ui-icon-star"/>
				<p:tooltip 
					for="saveButton" 
					value="Salva i dati dell'addetto" 
					showEffect="fade" 
					hideEffect="fade"/>
			</p:column>
			
		</p:row>

	</p:panelGrid>
	
		
	<p:dialog
		id="scattaFotoDialog"
		header="Scatta una nuova foto" 
		widgetVar="scattaFotoDialogWidget" 
		modal="true"
		resizable="false"
		showEffect="fade" 
		hideEffect="fade"> 
		
		<p:panelGrid styleClass="form-panel">
			
			<p:row>
				<p:column styleClass="form-header">
					<h:outputText value="
						Il pannello permette di scattare una foto e di associarla all'addetto selezionato. 
						La funzionalità può essere utilizzata solo disponendo dell'apposito hardware (es. webcam)."/>					
				</p:column>
			</p:row>
			
			<p:row>
				<p:column>
					<p:photoCam 
						widgetVar="photoCam"
						listener="#{dettaglioAddettoFoto.onCapture}"
						update=":detailForm:fotoAddetto" />
				</p:column>
			</p:row>	
							
			<p:row>
				<p:column>
			        <p:commandButton 
			        	type="button" 
			        	value="Scatta" 
			        	onclick="photoCam.capture()"/>
				</p:column>
			</p:row>
	
		</p:panelGrid>
		
	</p:dialog>
	
		
	<p:dialog
		id="uploadFotoDialog"
		header="Carica una foto da file" 
		widgetVar="uploadFotoDialogWidget" 
		modal="true"
		resizable="false"
		showEffect="fade" 
		hideEffect="fade"> 
		
		<p:panelGrid styleClass="form-panel">
			
			<p:row>
				<p:column styleClass="form-header">
					<h:outputText value="
						Il pannello permette di caricare una foto da file e di associarla all'addetto selezionato."/>					
				</p:column>
			</p:row>
			
			<p:row>
				<p:column>
					<p:fileUpload 
						fileUploadListener="#{dettaglioAddettoFoto.onFileUpload}"  
						mode="advanced"
						update=":detailForm:fotoAddetto"  
						sizeLimit="500000"
						label="Seleziona"
						uploadLabel="Carica"
						cancelLabel="Annulla"
						invalidFileMessage="Tipo di file selezionato non valido"
						invalidSizeMessage="Il file eccede le dimensioni massime ammesse"
						allowTypes="/(\.|\/)(gif|jpe?g|png)$/"/>  
				</p:column>
			</p:row>	
	
		</p:panelGrid>
		
	</p:dialog>
	
	
	<p:confirmDialog 
		id="deleteFotoDialog"
		header="Elimina foto" 
		widgetVar="deleteFotoDialogWidget"
		message="Si conferma l'eliminazione della foto corrente? L'operazione non può essere annullata."
		showEffect="fade" 
		hideEffect="fade">
		
		<p:commandButton 
			value="Elimina" 
			process="@this"
			update=":detailForm:fotoAddetto" 
			oncomplete="deleteFotoDialogWidget.hide()"  
            actionListener="#{dettaglioAddettoFoto.doClean}" />
              
        <p:commandButton 
        	value="Annulla" 
        	onclick="deleteFotoDialogWidget.hide()" 
        	type="button" />
        	   
	</p:confirmDialog>
	
	
	
	<f:subview id="detailFamiliareView">
	
		<p:dialog 
			id="detailFamiliareDialog"
			header="Dati del familiare" 
			widgetVar="detailFamiliareDialogWidget" 
			modal="true"
			resizable="false"
			showEffect="fade" 
			hideEffect="fade"> 
					
			<p:messages id="messages" globalOnly="false" showSummary="false" showDetail="true" closable="true"/>
			
			<p:panelGrid id="panel" styleClass="form-panel">
							
				<p:row>
					<p:column colspan="2" styleClass="form-header">
						<h:outputText value="Il pannello permette di impostare le informazioni di dettaglio del familiare."/>
					</p:column>
				</p:row>
	
				<p:row>
					<p:column>
						<p:outputLabel for="codiceTipoFamiliare" value="Tipo familiare:" />
					</p:column>
					<p:column>
						<p:selectOneMenu
							required="true" 
							requiredMessage="Il campo tipo familiare è obbligatorio"
							id="codiceTipoFamiliare" 
							value="#{dettaglioAddettoFamiliari.codiceTipoFamiliare}"
							effect="fade">
							<f:selectItem itemLabel="Selezionare un tipo" itemValue="" />
							<f:selectItems 
								value="#{dettaglioAddettoFamiliari.listTipoFamiliare}" var="item"
								itemLabel="#{item.descrizione}" itemValue="#{item.id}" />
						</p:selectOneMenu>	
						<p:tooltip for="codiceTipoFamiliare" showEffect="fade" value="Tipologia di familiare" />
					</p:column>
				</p:row>
						
				<p:row>
					<p:column>							
						<p:outputLabel for="nome" value="Nome:" />
					</p:column>
					<p:column>
						<p:inputText value="#{dettaglioAddettoFamiliari.nome}" id="nome"
							required="true" requiredMessage="Il campo nome è obbligatorio"/>
						<p:watermark for="nome" value="Nome del familiare" />  
						<p:tooltip for="nome" showEffect="fade" value="Campo nome del familiare" />
					</p:column>
				</p:row>
						
				<p:row>
					<p:column>							
						<p:outputLabel for="cognome" value="Cognome:" />
					</p:column>
					<p:column>
						<p:inputText value="#{dettaglioAddettoFamiliari.cognome}" id="cognome"
							required="true" requiredMessage="Il campo cognome è obbligatorio"/>
						<p:watermark for="cognome" value="Cognome del familiare" />  
						<p:tooltip for="cognome" showEffect="fade" value="Campo cognome del familiare" />
					</p:column>
				</p:row>
						
				<p:row>
					<p:column>							
						<p:outputLabel for="luogoNascita" value="Luogo di nascita:" />
					</p:column>
					<p:column>
						<p:inputText value="#{dettaglioAddettoFamiliari.luogoNascita}" id="luogoNascita"/>
						<p:watermark for="luogoNascita" value="Luogo di nascita del familiare" />  
						<p:tooltip for="luogoNascita" showEffect="fade" value="Campo luogo di nascita del familiare" />
					</p:column>
				</p:row>
						
				<p:row>
					<p:column>							
						<p:outputLabel for="dataNascita" value="Data di nascita:" />
					</p:column>
					<p:column>
						<p:calendar value="#{dettaglioAddettoFamiliari.dataNascita}" id="dataNascita"
							locale="it" pattern="dd/MM/yyyy"/>
						<p:watermark for="dataNascita" value="Data di nascita del familiare" />  
						<p:tooltip for="dataNascita" showEffect="fade" value="Campo data di nascita del familiare" />
					</p:column>
				</p:row>
						
				<p:row>
					<p:column>							
						<p:outputLabel for="note" value="Note:" />
					</p:column>
					<p:column>
						<p:inputTextarea value="#{dettaglioAddettoFamiliari.note}" id="note"/>
						<p:watermark for="note" value="Eventuali annotazioni sul familiare" />  
						<p:tooltip for="note" showEffect="fade" value="Eventuali annotazioni sul familiare" />
					</p:column>
				</p:row>
	
				<p:row>
					<p:column colspan="2" styleClass="form-footer">
						<p:commandButton value="Salva"
							id="saveButton"
							actionListener="#{dettaglioAddettoFamiliari.doSave}" 
							update="detailFamiliareView:messages,detailFamiliareView:panel,:detailForm:familiariTable,:detailForm:growl"
							process="detailFamiliareView:detailFamiliareDialog"
							oncomplete="if(args.ok) { detailFamiliareDialogWidget.hide(); }"/>
						<p:commandButton value="Annulla"
							type="button"
							onclick="detailFamiliareDialogWidget.hide();" />
					</p:column>
				</p:row>
				
			</p:panelGrid>
		
			<p:defaultCommand target="saveButton" scope="detailFamiliareDialog"/>
	
		</p:dialog>
	
	</f:subview>
	
	
	<p:confirmDialog 
		id="deleteFamiliareDialog"
		header="Elimina familiare" 
		widgetVar="deleteFamiliareDialogWidget"
		message="Si conferma l'eliminazione del familiare selezionato? L'operazione non può essere annullata."
		showEffect="fade" 
		hideEffect="fade">
		
		<p:commandButton 
			value="Elimina"
			update=":detailForm:familiariTable,:detailForm:growl"
			process="@this" 
			oncomplete="deleteFamiliareDialogWidget.hide()"  
            actionListener="#{dettaglioAddettoFamiliari.doDelete}" />
              
        <p:commandButton 
        	value="Annulla" 
        	onclick="deleteFamiliareDialogWidget.hide()" 
        	type="button" />
        	   
	</p:confirmDialog>
	
</html>